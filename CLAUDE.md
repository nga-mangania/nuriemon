# CLAUDE AIアシスタント専用 - 必須ルール

## 🚨 絶対に守るべきルール 🚨

### 1. 実装前の必須確認事項
- [ ] REQUIREMENTS.mdを読み返したか？
- [ ] 設計を説明して承認を得たか？
- [ ] 既存のコードスタイルを確認したか？
- [ ] 「とりあえず動く」実装になっていないか？

### 2. 禁止事項
- ❌ 設計説明なしでのコード実装
- ❌ ポーリングなど非効率な実装
- ❌ エラーハンドリングの省略
- ❌ 既存のアーキテクチャを無視した実装
- ❌ READMEやドキュメントの勝手な作成

### 3. 必須アクション
1. **新機能実装時**
   ```
   1. まず設計を説明
   2. ユーザーの承認を得る
   3. 実装を開始
   4. 完了後、改善案を提示
   ```

2. **既存コード修正時**
   ```
   1. 周辺コードを必ず確認
   2. 既存のパターンに従う
   3. より良い方法があれば提案
   ```

### 4. 品質基準
- 商用製品として恥ずかしくない品質
- パフォーマンスを考慮した実装
- 将来の拡張性を確保
- 適切なエラーハンドリング

### 5. コミュニケーション
- 常に日本語で応答
- 簡潔で的確な説明
- 問題発見時は即座に報告

## このファイルは毎回の作業開始時に必ず確認すること！

## 最新の研究メモ

### Rustエラー対応メモ

- Actix-webとTauriのスレッド間連携における!Send問題の発見
  - 根本原因: HttpServerインスタンスのスレッド間移動制限
  - 解決策: `tauri::async_runtime::spawn` の使用
  - エラーの特徴:
    - `(dyn std::any::Any + 'static)` がスレッド間で安全に送信できない
    - Rc<...> による内部的な制約が原因
  - 修正ポイント: 
    1. std::thread::spawnの代わりにtauri::async_runtime::spawnを使用
    2. スレッドセーフなランタイム管理の実装

### Geminiとのやりとり - システム反省と自己改善

- 自己批判的な対話: 実装プロセスにおける網羅的確認の重要性
  - 問題の本質: 場当たり的な修正と全体的な影響の軽視
  - 具体的な反省点:
    1. 状態同期の不完全な設計
    2. 権限設定の副作用に対する無配慮
    3. デバッグ可能性の喪失
  - 修正アプローチ:
    1. 全ウィンドウでのデバッグ強化
    2. 状態同期のアーキテクチャ再設計
    3. ギャラリー機能の徹底的な修復
  - 教訓: 個別の修正よりも全体的な一貫性と整合性の重視