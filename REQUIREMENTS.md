# ぬりえもん デスクトップアプリ版 要件定義書

## プロジェクト概要

### 背景
- 既存のWebアプリケーション「ぬりえもん」（oekaki-screen）をデスクトップアプリケーションとして再構築
- 元プロジェクト: `/Users/nga/oekaki-screen` (Webアプリ版)
- 新プロジェクト: `/Users/nga/nuriemon` (デスクトップ版)

### 目的
1. **完全オフライン化**: インターネット接続不要で全機能を利用可能に
2. **軽量化**: アプリケーションサイズを最小限に（目標: 30MB以下）
3. **モダン化**: 1年以上前のコードベースを最新技術で刷新
4. **配布容易性**: 一般ユーザーが簡単にインストール・利用できる形に

## 技術選定

### 採用技術スタック
- **フレームワーク**: Tauri (Rust + WebView)
- **フロントエンド**: React 18+ with TypeScript
- **ビルドツール**: Vite
- **スタイリング**: CSS Modules + Sass (Tailwind CSSは不採用)
- **画像処理**: Python (rembg/U2Net) - sidecarとしてバンドル
- **ローカルDB**: SQLite
- **状態管理**: Zustand または Jotai

### 不採用とした選択肢
- Electron: アプリサイズが大きい（150MB以上）
- React Native Desktop: 既存資産の活用が困難
- Flutter Desktop: React資産を活かせない

## 機能要件

### コア機能（既存機能の移植）
1. **画像アップロード・処理**
   - ローカルファイルシステムからの画像選択
   - AI背景除去機能（Python sidecar）
   - 処理済み画像のローカル保存

2. **アニメーション機能**
   - 画像の動き設定（移動、速度、サイズ、タイプ）
   - Canvas描画によるアニメーション表示
   - 音響効果（ローカル音源）

3. **ギャラリー機能**
   - 処理済み画像の一覧表示
   - 画像の管理（削除、編集）

4. **共有機能（オフライン版）**
   - ローカルファイルとしてエクスポート
   - 他のぬりえもんユーザーとのファイル共有

### 新規要件
1. **ローカルユーザー管理**
   - マルチユーザー対応（家族での共用を想定）
   - プロファイル切り替え機能

2. **自動アップデート機能**
   - アプリケーションの自動更新通知・実行

## 非機能要件

### パフォーマンス
- 起動時間: 3秒以内
- 画像処理: 1枚あたり5秒以内（背景除去）
- メモリ使用量: 500MB以下

### セキュリティ
- ローカルデータの暗号化（オプション）
- 外部通信なし（完全オフライン）

### 配布
- Windows: MSIインストーラー（コード署名推奨）
- macOS: DMGファイル（公証対応）
- インストールサイズ: 30MB以下目標

## システムアーキテクチャ

```
nuriemon/
├── src-tauri/              # Tauriバックエンド (Rust)
│   ├── src/
│   │   ├── main.rs         # メインプロセス
│   │   ├── commands.rs     # フロントエンドAPIコマンド
│   │   ├── db.rs           # SQLite操作
│   │   └── file_system.rs  # ファイル管理
│   └── tauri.conf.json     # Tauri設定
├── src/                    # Reactフロントエンド
│   ├── App.tsx            # メインアプリケーション
│   ├── components/        # UIコンポーネント
│   ├── services/          # ビジネスロジック
│   ├── hooks/             # カスタムフック
│   └── styles/            # Sass/CSSモジュール
├── python-sidecar/        # Python画像処理
│   ├── main.py           # エントリーポイント
│   ├── requirements.txt  # 依存関係
│   └── dist/             # PyInstallerビルド出力
└── vite.config.ts        # Vite設定
```

## データ移行計画

### 既存システムからの変更
| 既存 (Web版) | 新規 (デスクトップ版) |
|------------|------------------|
| Firebase Auth | ローカル認証 (SQLite) |
| Firestore | SQLite |
| Cloud Storage | ローカルファイルシステム |
| SendGrid | システム通知 |
| オンライン共有 | ファイルエクスポート |

### データ保存場所
- Windows: `%APPDATA%/nuriemon/`
- macOS: `~/Library/Application Support/nuriemon/`
- Linux: `~/.config/nuriemon/`

## 開発ロードマップ

### Phase 1: 基盤構築
1. Tauriプロジェクトのセットアップ
2. 基本的なReact + TypeScript環境構築
3. Python sidecarの統合テスト

### Phase 2: コア機能実装
1. 画像アップロード・表示機能
2. Python背景除去処理の統合
3. ローカルストレージ実装

### Phase 3: UI/UX改善
1. 既存UIの移植・改善
2. アニメーション機能の実装
3. ギャラリー機能の実装

### Phase 4: 配布準備
1. インストーラー作成
2. 自動アップデート機能
3. ドキュメント整備

## 制約事項

1. **Tailwind CSS不使用**: 明示的な要望により採用しない
2. **完全オフライン**: インターネット接続を前提としない設計
3. **既存資産の活用**: 可能な限り既存のReactコンポーネントを再利用

## 参考情報

- 元プロジェクトリポジトリ: `/Users/nga/oekaki-screen`
- 主要な既存コンポーネント:
  - UploadPage.js: 画像アップロード機能
  - ViewPage.js: アニメーション表示
  - ImageGallery.js: ギャラリー機能

## 備考

このドキュメントは、AIアシスタントとの会話履歴に基づいて作成されました。
新しいAIセッションでも、このドキュメントを参照することで、プロジェクトの継続が可能です。

最終更新: 2025-07-14